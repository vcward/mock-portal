<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="assets/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">
    <!-- <link href="assets/css/style.css" rel="stylesheet" type="text/css"> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="assets/js/bootstrap.js"></script>
    <script src="assets/js/d3.min.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="assets/js/chartTheme.js"></script>
    <script src="assets/js/lineBar.js"></script>

</head>

<body>
   <nav class="navbar navbar-default">
      <div class="container-fluid">
         <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
               <span class="sr-only">Toggle navigation</span>
               <span class="icon-bar"></span>
               <span class="icon-bar"></span>
               <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Data Portal</a>
         </div>

         <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
               <li><a href="#">Home</a></li>
               <li><a href="#">Tables</a></li>
               <li><a href="#">Graphs</a></li>
               <li><a href="#">Forecasts</a></li>
               <li><a href="#">UHERO</a></li>
            </ul>
         </div>
      </div>
   </nav>

   <div class="container-fluid">
      <div class="row">
         <div class="col-lg-6 col-md-6 col-sm-12">
            <ul id="categoryList">Categories</ul>
         </div>
         <div class="col-lg-6 col-md-6 col-sm-12">
            <div id="lineBar"></div>
         </div>
      </div>
   </div>

   <script>
      d3.json('http://localhost:8080/v1/category', function(data) {
         var categories = data.categories;

         var dataMap = categories.reduce(function(map, value) {
            map[value.id] = value;
            return map;
         }, {});

         console.log(categories);

         var categoryTree = [];
         categories.forEach(function(value) {
            var parent = dataMap[value.parent];
            if(parent) {
               (parent.children || (parent.children = []))
                  .push(value);
            } else {
               categoryTree.push(value);
            }
         });

         console.log(categoryTree);

         var list = d3.select('#categoryList');
         list.selectAll('li')
            .data(categoryTree)
            .enter().append('li')
            .text(function(d) { return d.name; })
            .on('click', expand);

         function expand(d) {
            d3.select(this)
               .on('click', collapse)
               .append('ul')
               .selectAll('li')
               .data(d.children)
               .enter().append('li')
               .text(function(d) { return d.name; });
         };

         function collapse(d) {
            d3.select(this)
               .on('click', expand)
               .selectAll('li')
               .remove()
         };
      });
   </script>
</body>
</html>
